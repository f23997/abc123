
安装docker
如果安装最新版，直接输入如下命令即可

apt install docker-ce docker-ce-cli containerd.io
如果想安装特定版本的docker，那先查看一下支持哪些版本

apt list -a docker-ce


通过在软件包名后面添加版本=<VERSION>来安装指定版本：

apt install docker-ce=<VERSION> docker-ce-cli=<VERSION> containerd.io
最早的版本也得是5:20.10.13~3-0了

比如apt install docker-ce=5:20.10.13~3-0~ubuntu-jammy docker-ce-cli=5:20.10.13~3-0~ubuntu-jammy containerd.io

 安装完之后输入docker --version看一下版本号
 
 
 卸载docker
# 如果在运行，先停止docker
systemctl stop docker
 
# 卸载docker软件包
apt purge docker-ce docker-ce-cli containerd.io
 
# 删除docker项目目录，我还要多删除一个自定义的缓存目录
rm -rf /var/lib/docker
rm -rf /etc/docker


# 删除docker用户组
groupdel docker

修改docker的镜像源
如果你在下载某些镜像的时候老超时失败，那你需要配一个docker的镜像源了，以我的ubuntu22.04为例，亲测有效

# 编译docker的daemon文件，默认应该是没有的
vi /etc/docker/daemon.json
 
# 打开文件之后复制一下内容，我用的是网易的源
{
  "registry-mirrors": ["http://hub-mirror.c.163.com"]
}






mkdir -p /opt/apps/openvpn


下载op
docker pull kylemanna/openvpn:2.4


docker run -v /opt/apps/openvpn:/etc/openvpn --rm kylemanna/openvpn:2.4 ovpn_genconfig -u tcp://公网IP



#生成密钥文件
docker run -v /opt/apps/openvpn:/etc/openvpn --rm -it kylemanna/openvpn:2.4 ovpn_initpki



输入私钥密码（输入时是看不见的）：
Enter PEM pass phrase:12345678


再输入一遍
Verifying - Enter PEM pass phrase:12345678
输入一个CA名称（我这里直接回车）
Common Name (eg: your user, host, or server name) [Easy-RSA CA]:
输入刚才设置的私钥密码（输入完成后会再让输入一次）
Enter pass phrase for /etc/openvpn/pki/private/ca.key:12345678



#生成客户端证书（这里的whsir改成你想要的名字）


docker run -v /opt/apps/openvpn:/etc/openvpn --rm -it kylemanna/openvpn:2.4 easyrsa build-client-full whsir nopass



再输入密码12345678



#导出客户端配置
mkdir -p /opt/apps/openvpn/conf
docker run -v /opt/apps/openvpn:/etc/openvpn --rm kylemanna/openvpn:2.4 ovpn_getclient whsir> /root/whsir.ovpn




#启动OpenV服务
docker run --name openvpn -v /opt/apps/openvpn:/etc/openvpn -d -p 1194:1194/tcp --cap-add=NET_ADMIN kylemanna/openvpn:2.4
PS：
停止 openvpn
docker stop openvpn
启动 openvpn
docker start openvpn
#需要重启openvpn
docker restart openvpn



#创建用户脚本 user_create.sh
#!/bin/bash
read -p "please your username: " NAME
docker run -v /opt/apps/openvpn:/etc/openvpn --rm -it kylemanna/openvpn:2.4 easyrsa build-client-full $NAME nopass
docker run -v /opt/apps/openvpn:/etc/openvpn --rm kylemanna/openvpn:2.4 ovpn_getclient $NAME > /opt/apps/openvpn/conf/"$NAME".ovpn

#删除用户脚本 user_del.sh
#!/bin/bash
read -p "Delete username: " DNAME
docker run -v /opt/apps/openvpn:/etc/openvpn --rm -it kylemanna/openvpn:2.4 easyrsa revoke $DNAME
docker run -v /opt/apps/openvpn:/etc/openvpn --rm -it kylemanna/openvpn:2.4 easyrsa gen-crl
docker run -v /opt/apps/openvpn:/etc/openvpn --rm -it kylemanna/openvpn:2.4 rm -f /etc/openvpn/pki/reqs/"$DNAME".req
docker run -v /opt/apps/openvpn:/etc/openvpn --rm -it kylemanna/openvpn:2.4 rm -f /etc/openvpn/pki/private/"$DNAME".key
docker run -v /opt/apps/openvpn:/etc/openvpn --rm -it kylemanna/openvpn:2.4 rm -f /etc/openvpn/pki/issued/"$DNAME".crt


